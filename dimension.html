<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
<script type="text/javascript" src="series.js"></script>

<script type="text/javascript">

// compute the Hilbert series for a complete intersection with degrees m in PG(n, k)
function HilbertSeries(n, m, precision) {
  if (precision === undefined)
    precision = Series._defaultPrecision;

  H = new Series([1, -1], precision);
  H = H.invert().power(n + 1);

  for (i in m) {
    factor = new Series([1], precision);
    factor.coefficient(m[i], -1);

    H = H.multiply(factor);
  }

  return H;
}


function h(n, m, q, r) {
  // computation of N for Serre duality
  function N(n, m) {
    return _.reduce(m, function (a, b) { return a + b; }, 0) - n - 1;
  }

  // global sections
  if (q == 0) {
    // zero-dimensional schemes have to circumvent the Hilbert series
    if (n == m.length)
      return _.reduce(m, function (a, b) { return a * b; }, 1);
    
    // there are global sections
    if (r >= 0)
      return HilbertSeries(n, m, r + 1).coefficient(r);
    // no global sections
    else
      return 0;
  }

  // apply Serre duality
  else if (q == n - m.length) {
    return h(n, m, 0, N(n, m) - r);
  }

  // nothing in the middle terms
  return 0
}

n = 5;
m = [2, 5, 3];

function drawDimensions(n, m) {
  // we calculate the dimensions
  var data = []

  for (var r = 7; r > -6; r--) {
    data[r] = [];

    for (var q = -1; q < n - m.length + 2; q++)
      data[r][q] = h(n, m, q, r);
  }

  // we collect the twisting indices to sort them
  var twists = []
  for (var r in data) twists.push(parseInt(r));
  twists.sort(function(a, b) { return a - b; });
  twists.reverse();

  // we collect the cohomological indices to sort them
  var degrees = []
  for (var q in data[0]) degrees.push(parseInt(q));
  degrees.sort(function(a, b) { return a - b;});

  // we create the table
  var table = $("<table></table>");

  for (var i in twists) {
    var row = $("<tr></tr>");

    for (var j in degrees)
      row.append("<td>" + data[twists[i]][degrees[j]] + "</td>");

    table.append(row);
  }

  return table;

}

$(document).ready(function() {
  $("body").append(drawDimensions(n, m));
});

</script>

<style type="text/css">
td {
  text-align: center;
}
</style>
</head>

<body>
<form>
  <label>dimension:</label><input type="range" min="1" max="10" step="1"><br>
  <label>number of equations:</label><input type="range" min="1" max="10" step="1"> <!-- TODO should change according to dimension -->

  <fieldset>
    <legend>degrees</legend>
    <label>degree:</label><input type="range" min="1" max="10" step="1"><br>
    <label>degree:</label><input type="range" min="1" max="10" step="1"><br>
    <label>degree:</label><input type="range" min="1" max="10" step="1">
  </fieldset>
</form>
</body>
</html>
